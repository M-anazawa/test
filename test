AWSアカウントAにあるS3のデータをAWSアカウントBにあるS3に移行します。
移行方法はAWSアカウントAにあるEC2から下記のAWS CLIを実行し、AWSアカウントAにあるインターフェース型S3エンドポイントを経由させます。
この際、AWSアカウントBのS3バケットポリシー設定をAWSアカウントAのEC2に適用しているIAMロールとAWSアカウントAにあるインターフェース型S3エンドポイントのアンドで許可することは可能ですか？

aws s3 sync [AWSアカウントAのS3パス] [AWSアカウントBのS3パス] --endpoint-url [エンドポイントDNS]


結論として、「aws s3 sync s3://(AccountAバケット) s3://(AccountBバケット) を実行したときに発生する“Server-Side Copy (CopyObject)”リクエストを、Account A 側のインターフェース型S3エンドポイント経由に限定し、それを Account B 側のバケットポリシーで aws:sourceVpce と IAM ロールの両条件(AND)で許可する」ことは原則できません。

理由を順を追って解説します。
1. Server-Side Copy と VPCエンドポイントの関係
aws s3 sync s3://source-bucket s3://dest-bucket のように ソースもデスティネーションも s3:// 指定の場合、AWS CLI は基本的に S3 の CopyObject または UploadPartCopy を使用した Server-Side Copy を行います。

Server-Side Copy は、S3サービス内部でオブジェクトがコピーされる仕組みです。
オブジェクトの実データは S3 内部 で完結し、VPC やインターネットを“通らない” ため、インターフェース型エンドポイント (VPC PrivateLink) が関与する経路にはなりません。
CLI は何をしているのか
AWS CLI は「どのオブジェクトをコピーするか」「どこへコピーするか」の制御プレーンとして、S3 API (CopyObject など) を呼び出します。
しかし 実際のデータ転送 は S3 内部で完結します。そのため「aws:sourceVpce 条件を満たすネットワーク経路でオブジェクトをコピーする」といった制御はできません。
なぜ aws:sourceVpce が機能しないのか
S3バケットポリシーで aws:sourceVpce を使った条件は「VPCエンドポイント経由で届く データプレーンリクエスト（GET/PUTなど）に限定する」ためのものです。
しかし Server-Side Copy の PUT や GET は「S3 が S3 に対して行う内部処理」であり、お客様の VPC からのリクエストではありません。そのため aws:sourceVpce は当てはまらず、VPC エンドポイントを強制することはできません。


2. 「IAMロール＋VPCエンドポイント」の AND 条件付け自体は可能か
バケットポリシーの書き方として は、以下のように「特定の IAM ロール (クロスアカウントロール)」かつ「aws:sourceVpce が指定のエンドポイントID」の両方を満たす場合に許可する、という構成自体は書くことが可能です。

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowPutObjectFromSpecificRoleAndVPCE",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::123456789012:role/YourCrossAccountRole"
      },
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::YourBucketB/*",
      "Condition": {
        "StringEquals": {
          "aws:sourceVpce": "vpce-abcdefgh123456789"
        }
      }
    }
  ]
}

しかし、Server-Side Copy によるオブジェクト PUT/GET では aws:sourceVpce 条件がマッチしません（S3内部コピーのため）。結果的に 「BucketB へのコピーが拒否される」または「サーバーサイドコピー自体がエラーになる」 という挙動になります。


3. インターフェース型エンドポイントを経由して転送したい場合
もし「どうしても Account A 側のインターフェース型 S3 エンドポイント経由でデータを転送させたい」という要件がある場合は、**サーバーサイドコピーを使わず、EC2（CLI）に一度データをダウンロードしてからアップロードする“クライアントサイドコピー”**に切り替える必要があります。

3.1 クライアントサイドコピーの流れ
Account A の EC2 上で

# （1）ソースバケット(S3) → EC2 へダウンロード
aws s3 sync s3://(AccountAバケット) /local/path \
    --endpoint-url https://vpce-xxx-yyy.s3.region.amazonaws.com

# （2）EC2 → デスティネーションバケット(S3) へアップロード
aws s3 sync /local/path s3://(AccountBバケット) \
    --endpoint-url https://vpce-xxx-yyy.s3.region.amazonaws.com

※ 上記の --endpoint-url でインターフェース型エンドポイントの Private DNS 名を指定
オブジェクトデータの実転送は「VPC → S3」の経路となり、aws:sourceVpce 条件にマッチする。
これにより、実際のオブジェクトデータ が VPC エンドポイントを経由して EC2 に入り、そこから再度 VPC エンドポイント経由でアップロードされます。

バケットポリシーで aws:sourceVpce ＋ IAMロールを AND 条件にしていれば、アップロード (PUT) は許可されます。

注意点
データ容量が大きい場合、EC2 に一時的に保存するストレージが必要になるほか、転送時間・コストもサーバーサイドコピーより増加します。
「どうしてもネットワーク経路を限定したい」「外部通信をさせたくない」というセキュリティ要件がある場合にのみ、この方式が選択されることが多いです。

4. まとめ
Server-Side Copy（aws s3 sync s3://～ s3://～ のデフォルト挙動）は、S3内部通信で完結するため VPCエンドポイントを経由しない。
結果として、aws:sourceVpce 条件を使ったバケットポリシーとは相性が悪い（ほぼ拒否される）。
「IAMロール × aws:sourceVpce の AND 条件」をバケットポリシーに書くこと自体は構文上可能。
しかし Server-Side Copy ではその条件を満たせず、コピーが通らない。
どうしてもインターフェース型エンドポイントを経由したデータ転送を行いたい場合
クライアントサイドコピー (EC2に一度GET→再度PUT) を行うことで、VPC経由でのオブジェクト転送が可能になる。
その際、バケットポリシーの aws:sourceVpce が機能するようになる。

以上から、「バケットポリシーで Account A の EC2 が使う IAM ロール と インターフェース型S3エンドポイント を AND 条件にして許可する」こと自体は設定可能ですが、Server-Side Copy の場合は適用されずに失敗してしまう という点にご注意ください。もし本当に VPC 経由での転送制御を求めるのであれば、クライアントサイドコピー方式に変更する必要があります。






次のように--endpoint-urlにインターフェース型S3エンドポイントDNSを指定した場合、S3への指令はインターフェース型S3エンドポイントを経由して行われ、デートの転送はAWSアカウントAのS3とAWSアカウントBのS3間で直接行われる認識であっていますか？

aws s3 sync [AWSアカウントAのS3パス] [AWSアカウントBのS3パス] --endpoint-url [インターフェース型S3エンドポイントDNS]



はい、その認識で正しいです。

--endpoint-url に インターフェース型S3エンドポイントのDNS名 を指定すると、
「AWS CLI が S3サービスへ送る APIリクエスト（制御プレーン通信）」はそのエンドポイント経由 で行われます。
一方で、
「実際のオブジェクトデータのコピー（データプレーン）」は、S3サービス内部での Server-Side Copy により、
Account A の S3 と Account B の S3 間で直接やり取り されます。
つまり、「APIリクエスト自体はインターフェース型エンドポイントを通るが、オブジェクトデータはEC2を経由せずにS3間でコピーされる」という挙動になります。






aws s3 syncを実行するEC2に適用するIAMロールを必要最低限の内容で教えてください


「必要最低限の権限」は状況によって若干異なりますが、一般的に aws s3 sync s3://ソースバケット s3://デスティネーションバケット を実行するだけなら、以下のアクションがあれば十分です。

ソースバケット

s3:ListBucket (バケット内のオブジェクト一覧を取得する)
s3:GetObject (オブジェクトを読み出す)
s3:GetBucketLocation (バケットのリージョン情報を取得する) ※CLI 内部で利用される場合がある
デスティネーションバケット

s3:ListBucket (同期時に差分比較のためバケット内一覧を取得する)
s3:GetBucketLocation (同上)
s3:PutObject (オブジェクトを書き込む)
s3:AbortMultipartUpload (マルチパートアップロード途中で失敗した場合に中断するため)
もし sync --delete オプションなどでデスティネーション側の不要オブジェクトを削除する場合は、さらに s3:DeleteObject が必要です。

ポリシー例
以下のように ソースバケット用 と デスティネーションバケット用 でステートメントを分けて記述します。

ListBucket や GetBucketLocation は バケットの ARN (ワイルドカードなし)
GetObject / PutObject / DeleteObject は オブジェクトパス (ワイルドカードつき)
を指定する必要がある点に注意してください。

{
  "Version": "2012-10-17",
  "Statement": [

    // ---------- ソースバケット権限 ----------
    {
      "Sid": "AllowListSourceBucket",
      "Effect": "Allow",
      "Action": [
        "s3:ListBucket",
        "s3:GetBucketLocation"
      ],
      "Resource": "arn:aws:s3:::SOURCE_BUCKET_NAME"
    },
    {
      "Sid": "AllowGetSourceObjects",
      "Effect": "Allow",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::SOURCE_BUCKET_NAME/*"
    },

    // ---------- デスティネーションバケット権限 ----------
    {
      "Sid": "AllowListDestBucket",
      "Effect": "Allow",
      "Action": [
        "s3:ListBucket",
        "s3:GetBucketLocation"
      ],
      "Resource": "arn:aws:s3:::DESTINATION_BUCKET_NAME"
    },
    {
      "Sid": "AllowPutDestObjects",
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:AbortMultipartUpload"
      ],
      "Resource": "arn:aws:s3:::DESTINATION_BUCKET_NAME/*"
    }

    // ※ デスティネーションの不要ファイルを削除する場合（sync --delete）:
    // {
    //   "Sid": "AllowDeleteDestObjects",
    //   "Effect": "Allow",
    //   "Action": "s3:DeleteObject",
    //   "Resource": "arn:aws:s3:::DESTINATION_BUCKET_NAME/*"
    // }
  ]
}

上記ポリシーを EC2 インスタンスに割り当てる IAM ロール（または使用する IAM ユーザー / IAM ロール）に付与することで、
aws s3 sync s3://SOURCE_BUCKET_NAME s3://DESTINATION_BUCKET_NAME を正常に実行できます。

ポイント
「ListBucket」はバケットARN(ワイルドカードなし)に付与
「GetObject / PutObject / DeleteObject」は「arn:aws:s3:::バケット名/*」に付与
マルチパート失敗時の中断に備えて s3:AbortMultipartUpload も付与
追加要件 (sync --delete で削除をしたい等) に応じて DeleteObject を付与
このようにすることで、「必要最小限」かつ「CLIによる同期に必要十分な」権限を与えることができます。




















