name: Clear Branch History

on:
  workflow_dispatch:
    inputs:
      target_branch:
        description: 'The branch to clear history'
        required: true
        type: choice
        options:
          - AaaPrdWebapp
          - BbbPrdWebapp

jobs:
  clear-history:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Ensure all history is fetched
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Clear history
      run: |
        TARGET_BRANCH=${{ github.event.inputs.target_branch }}

        # Checkout an orphan branch (no parents)
        git checkout --orphan temp-branch

        # Remove all files
        git rm -rf .

        # Create an empty commit
        git commit --allow-empty -m "Clearing branch history"

        # Delete the target branch
        git push origin --delete $TARGET_BRANCH

        # Rename the temporary branch to the target branch
        git branch -m $TARGET_BRANCH

        # Force push the new branch to origin
        git push --force origin $TARGET_BRANCH
